---
import { getCollection } from "astro:content"
import BaseLayout from "@/layouts/BaseLayout.astro"

// head
const title = "Giban"
const description = "Welcome to the demo page"
const { href: url } = Astro.url

// content
const allPosts = await getCollection("all")
const recent = allPosts
	.sort(
		({ data: { date: dateA } }, { data: { date: dateB } }) =>
			dateB.valueOf() - dateA.valueOf(),
	)
	.slice(0, 5)
const tags = allPosts.reduce((acc, v) => {
	v.data.tags.forEach(tag => {
		if (Object.hasOwn(acc, tag)) {
			acc[tag] += 1
		} else {
			acc[tag] = 1
		}
	})
	return acc
}, {} as Record<string, number>)
---
<BaseLayout {title} {description} {url}>
	<main>
		<h1>Giban</h1>
		<h2>Recent Posts</h2>
		<ul>
			{
				recent
					.map(({ id, data: { title } }) => (
						<li>
							<a href={`/${id}`}>{title}</a>
						</li>
					))
			}
		</ul>

		<h2>Tags</h2>
		<ul>
			{
				Object.entries(tags).map(([k, v]) => (
					<li>{k}: {v}</li>
				))
			}
		</ul>
	</main>
</BaseLayout>
